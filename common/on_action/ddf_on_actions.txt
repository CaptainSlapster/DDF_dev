#
# This is the master for the on_actions associated with DDF
#

on_game_start_after_lobby = { #This is just incase all characters weren't caught
	on_actions = {
		apply_sickle_cell ##Apply sickle cell trait to certain cultures
		launch_intro_event
	}
}

launch_intro_event = {
	effect = {
		every_player = {
			trigger_event = ddf_update.0001
		}
	}
}

apply_sickle_cell = {
	trigger = {NOT = {has_global_variable = AGOT_is_loaded}}
	effect = {
		every_living_character = {
			limit = {
				AND = {
					NOT = {
						has_trait = sickle_cell
					}
					sickle_cell_culture_trigger = yes
				}
			}
			trigger_event = ddf_health.0018	
		}
	}
}



random_yearly_everyone_pulse = {
    on_actions = {
        ddf_yearly_health_pulse
        ddf_prison_maintenance_pulse
		#Create mortality pulse So it can be controlled here
    }    
}

five_year_everyone_pulse = {
    on_actions = {
        ddf_disease_outbreak_pulse #DDF disease outbreaks. 
	}
}

###
# Prison stuff
##

ddf_prison_maintenance_pulse = {
	trigger = {
		any_prisoner = { count >= 1 }
	}
	on_actions = {
		#Set up quarterly pulses
		delay = { days = 45 }
		ddf_quarterly_prison_maintenance_pulse
		delay = { days = 135 }
		ddf_quarterly_prison_maintenance_pulse
		delay = { days = 225 }
		ddf_quarterly_prison_maintenance_pulse
		delay = { days = 315 }
		ddf_quarterly_prison_maintenance_pulse
	}
}


ddf_quarterly_prison_maintenance_pulse = {
	trigger = {
		any_prisoner = { count >= 1 }
	}
	effect = { #Fire the correct events for all prisoners
		#every_prisoner = {
		#	limit = {
		#		is_in_prison_type = house_arrest
		#	}
		#	trigger_event = {
		#		days = 1 # Queued, so we can check the pulse in parallel
		#		on_action = house_arrest_ongoing
		#	}
		#}
		every_prisoner = {
			limit = {
				is_in_prison_type = dungeon
			}
			trigger_event = {
				days = 1 # Queued, so we can check the pulse in parallel
				on_action = ddf_dungeon_ongoing
			}
		}
	}
}
