##
# ALL VALUES FOR THE FANTASY STUFF
##



# Outbreak

fantasy_outbreak_chance_base_extra_low = 0.0003 #0005
fantasy_outbreak_chance_base_very_low = 0.0007 #001
fantasy_outbreak_chance_base_low = 0.007 #01
fantasy_outbreak_chance_base_medium = 0.010 #02
fantasy_outbreak_chance_base_high = 0.04 #04
fantasy_outbreak_chance_base_very_high = 0.012 #12

fantasy_outbreak_increase_add_extra_low = 0.0002 #0.004
fantasy_outbreak_increase_add_low = 0.003 #0.004
fantasy_outbreak_increase_add_medium = 0.004 #0.008
fantasy_outbreak_increase_add_high = 0.012  #0.016
fantasy_outbreak_increase_add_very_high = 0.025 #0.032
fantasy_outbreak_increase_add_extra_high = 0.035 #0.064

fantasy_outbreak_decrease_add_low = -0.004
fantasy_outbreak_decrease_add_medium = -0.008
fantasy_outbreak_decrease_add_high = -0.016
fantasy_outbreak_decrease_add_very_high = -0.032
fantasy_outbreak_decrease_add_unlikely = -0.064

fantasy_outbreak_increase_mult_low = 0.1
fantasy_outbreak_increase_mult_medium = 0.2
fantasy_outbreak_increase_mult_high = 0.4
fantasy_outbreak_increase_mult_very_high = 0.8

fantasy_outbreak_decrease_mult_low = -0.3
fantasy_outbreak_decrease_mult_medium = -0.35
fantasy_outbreak_decrease_mult_high = -0.6
fantasy_outbreak_decrease_mult_very_high = -0.8
fantasy_outbreak_decrease_mult_unlikely = -0.995

fantasy_spread_chance_base_low = 6 # 3.5
fantasy_spread_chance_base_medium = 8 # 5
fantasy_spread_chance_base_high = 12 # 9

fantasy_spread_increase_add_low = 4 # 2
fantasy_spread_increase_add_medium = 5 # 3
fantasy_spread_increase_add_high = 6 # 4

fantasy_spread_decrease_add_low = -0.3 # 0.4
fantasy_spread_decrease_add_medium = -0.6
fantasy_spread_decrease_add_high = -1.5
fantasy_spread_decrease_add_very_high = -2.3

fantasy_spread_increase_mult_low = 0.4 #0.25
fantasy_spread_increase_mult_medium = 0.9 #0.75
fantasy_spread_increase_mult_high = 1.50 # 1
fantasy_spread_increase_mult_very_high = 2 # 1.75

fantasy_spread_decrease_mult_low = -0.22
fantasy_spread_decrease_mult_medium = -0.4
fantasy_spread_decrease_mult_high = -0.6
fantasy_spread_decrease_mult_unlikely = -0.87

##Dragon attacks are rare :)
dragon_attack_chance_low = {
	value = fantasy_outbreak_chance_base_extra_low 
	#Buildings
	if = {
		limit = {
			num_buildings >= 4
		}
		add = {
			value = num_buildings
			multiply = fantasy_outbreak_increase_add_extra_low
		}
	}

	#Estates 
	if = {
		limit = {
			has_building_or_higher = farm_estates_01
		}
		add = fantasy_outbreak_increase_add_extra_low
	}
	if = {
		limit = {
			has_building_or_higher = farm_estates_02
		}
		add = fantasy_outbreak_increase_add_extra_low
	}
	if = {
		limit = {
			has_building_or_higher = farm_estates_03
		}
		add = fantasy_outbreak_increase_add_extra_low
	}
	if = {
		limit = {
			has_building_or_higher = farm_estates_04
		}
		add = fantasy_outbreak_increase_add_low
	}
	if = {
		limit = {
			has_building_or_higher = farm_estates_05
		}
		add = fantasy_outbreak_increase_add_low
	}
	if = {
		limit = {
			has_building_or_higher = farm_estates_06
		}
		add = fantasy_outbreak_increase_add_medium
	}
	if = {
		limit = {
			has_building_or_higher = farm_estates_07
		}
		add = fantasy_outbreak_increase_add_medium
	}
	if = {
		limit = {
			has_building_or_higher = farm_estates_08
		}
		add = fantasy_outbreak_increase_add_medium
	}

	if = {
		limit = {
			OR = {
				has_global_variable = is_in_tutorial
				AND = {
					has_global_variable = start_epidemic_grace
					OR = {
						county.holder = { is_ai = no }
						county.holder = {
							any_liege_or_above = { is_ai = no }
						}
					}
				}
			}
		}
		multiply = 0
	}
}


dragon_attack_spread_chance_default_value = {
	add = spread_chance_base_low
	#less patchy, add
	if = {
		limit = {
			county = {
				any_county_province = {
					any_province_epidemic = {
						this.epidemic_type = scope:epidemic.epidemic_type
					}
				}
			}
		}
		add = spread_increase_add_high
	}

	#Dysentery spreads to armies and forts
	if = {
		limit = { scope:epidemic.epidemic_type = epidemic_type:dysentery }
		add = {
			if = {
				limit = {
					any_army_in_location ?= {
						is_army_in_siege = yes
					}
				}
				add = spread_increase_add_high
			}
			if = {
				limit = {
					any_army_in_location ?= {
						OR = {
							is_army_in_combat = yes
							is_army_in_raid = yes
						}
					}
				}
				add = spread_increase_add_medium
			}
			if = {
				limit = {
					any_army_in_location ?= {
						count >= 1
					}
				}
				add = spread_increase_add_high
			}			
		}
		add = {
			value = fort_level
			multiply = spread_increase_mult_low
		}
	}
	
	#Buildings
	add = {
		value = num_buildings
		multiply = spread_increase_mult_low
	}

	#Terrain
	if = {
		limit = {
			terrain = farmlands
		}
		add = spread_increase_add_medium
	}
	else_if = {
		limit = {
			OR = {
				terrain = floodplains
				terrain = wetlands
			}
		}
		add = spread_increase_add_low
	}
	else_if = {
		limit = {
			OR = {
				terrain = plains
				terrain = steppe
			}
		}
		add = spread_increase_add_low
	}
	else_if = {
		limit = {
			OR = {
				terrain = hills
				terrain = drylands
				terrain = oasis
				terrain = forest
			}
		}
		add = spread_decrease_add_low
	}
	else_if = {
		limit = {
			OR = {
				terrain = jungle
				terrain = taiga
			}
		}
		add = spread_decrease_add_medium
	}
	else_if = {
		limit = {
			OR = {
				terrain = desert
				terrain = desert_mountains
				terrain = mountains
			}
		}
		add = spread_decrease_add_medium
	}
	#Island?
	if = {
		limit = {
			geographical_region = divergence_island_regions
		}
		add = spread_decrease_add_medium
	}
	#Cultural Traditions
	if = {
		limit = {
			county.culture = {
				OR = {
					has_cultural_tradition = tradition_city_keepers
					has_cultural_tradition = tradition_maritime_mercantilism
				}
			}
		}
		add = spread_increase_add_medium
	}
	else_if = {
		limit = {
			county.culture = {
				OR = {
					has_cultural_tradition = tradition_esteemed_hospitality
					has_cultural_tradition = tradition_horse_lords
					has_cultural_tradition = tradition_caravaneers
					has_cultural_tradition = tradition_seafaring
				}
			}
		}
		add = spread_increase_add_low
	}
	else_if = {
		limit = {
			county.culture = {
				OR = {
					has_cultural_tradition = tradition_practiced_pirates
					has_cultural_tradition = tradition_parochialism
				}
			}
		}
		add = spread_increase_add_low
	}
	if = {
		limit = {
			county.culture = {
				has_cultural_tradition = tradition_hidden_cities
			}
		}
		add = spread_decrease_add_high
	}
	else_if = {
		limit = {
			county.culture = {
				has_cultural_parameter = less_plague_spread_culture
			}
		}
		add = spread_decrease_add_high
	}
	
	#Reinfection shouldn't happen often
	if = {
		limit = {
			scope:epidemic = {
				is_target_in_variable_list = {
					name = epidemic_cooldown
				}
			}
		}
		add = spread_decrease_add_very_high
	}
}

character_chance_of_being_attacked = {
	value = 5
	#If you're already sick/weak you're screwed
	if = { 
		limit = { 
			OR = {
				has_trait = sickly
				has_trait = weak
				age >= 60				
			}
		}
		add = 45
	}
	#Or those that want to fight the dragons#
	if = {
		limit = {
			OR = {
				has_trait = brave
				has_trait = strong
				has_trait = shrewd
			}
		}
		add = 20
	}
	#Attack Intensity
	if = {
		limit = {
			scope:epidemic ?={
				outbreak_intensity = minor
			}
		}
		add = 5 #15
	}

	#Let's see if you have any advantageous traits/perks / Wash your hands is included in the social distancing calculation, these are purely health related
	if = {
		limit = {
			has_trait = athletic
		}
		add = -10 #allows you to escape
	}
	if = {
		limit = {
			has_perk = healthy_perk
		}
		add = -10 #allows you to escape
	}
	if = {
		limit = {
			has_trait = whole_of_body
		}
		add = -10 #allows you to escape!
	}
	#Things to bump the numbers
	if = {
		limit = {
			is_foreign_court_or_pool_guest = yes
		}
		add = 40
	}
	if = {
		limit = {
			is_ruler = no
		}
		add = 25 # if you're not a ruler they'll find you and fuck you up
	}
	#"Old" people get fucked up more in general
	if = {
		limit = {
			age >= 65
		}
		add = 45
	}
	else_if = {
		limit = {
			age >= 50
		}
		add = 30
	}
	else_if = {
		limit = {
			age >= 40
		}
		add = 25
	}
	else_if = {
		limit = {
			age >= 30
		}
		add = 15
	}
	#children/babies are easier targets
	else_if = {
		limit = {
			age <= 15
		}
		add = 25
	}
	else_if = {
		limit = {
			age <= 5
		}
		add = 10
	}

	# Camp resistance.
	if = {
		limit = {
			host.domicile ?= { has_domicile_parameter = camp_infection_chance_buff_1 }
		}
		# Max buff.
		if = {
			limit = {
				host.domicile ?= { has_domicile_parameter = camp_infection_chance_buff_6 }
			}
			add = -40
		}
		# Very high buff.
		else_if = {
			limit = {
				host.domicile ?= { has_domicile_parameter = camp_infection_chance_buff_5 }
			}
			add = -30
		}
		# High buff.
		else_if = {
			limit = {
				host.domicile ?= { has_domicile_parameter = camp_infection_chance_buff_4 }
			}
			add = -25
		}
		# Medium buff.
		else_if = {
			limit = {
				host.domicile ?= { has_domicile_parameter = camp_infection_chance_buff_3 }
			}
			add = -20
		}
		# Small buff.
		else_if = {
			limit = {
				host.domicile ?= { has_domicile_parameter = camp_infection_chance_buff_2 }
			}
			add = -15
		}
		# Slight buff.
		else_if = {
			limit = {
				host.domicile ?= { has_domicile_parameter = camp_infection_chance_buff_1 }
			}
			add = -10
		}
	}
	#How infected is your location?
	#Follows the infection rate thresholds set for the barony/county modifiers
	#
	### Maybe i'll add dragon specific stuff idk it's fantasy
	#if = {
	#	limit = {
	#		location = { epidemic_resistance > 80 }
	#	}
	#	multiply = 0.25
	#}
	#else_if = {
	#	limit = {
	#		location = { epidemic_resistance > 50 }
	#	}
	#	multiply = 0.5
	#}
	#else_if = {
	#	limit = {
	#		location = { epidemic_resistance > 10 }
	#	}
	#	multiply = 0.75
	#}

	min = 1 # Never totally immune
}
